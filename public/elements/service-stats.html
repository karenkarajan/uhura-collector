<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="https://cdn.socket.io/socket.io-1.3.4.js"></script>

<polymer-element name="service-stats">
  <template>
    <link rel="stylesheet" type="text/css" href="/css/table.css">
    <table>
      <tr>
        <td>Process title</td>
        <td>{{title}}</td>
      </tr>
      <tr>
        <td>Process ID</td>
        <td>{{pid}}</td>
      </tr>
      <tr>
        <td>Process uptime</td>
        <td>{{uptime}}</td>
      </tr>
      <tr>
        <td>Heap total</td>
        <td>{{heapTotal}}</td>
      </tr>
      <tr>
        <td>Heap used</td>
        <td>{{heapUsed}}</td>
      </tr>
      <tr>
        <td>Total memory</td>
        <td>{{totalmem}}</td>
      </tr>
      <tr>
        <td>Free memory</td>
        <td>{{freemem}}</td>
      </tr>
    </table>
  </template>
  <script>
    Polymer({
      ready: function() {
        console.log('connecting to event collector');

        var socket = io.connect();
        socket.on('connect', function() {
          console.log('connected to event collector');
        });

        socket.on('event', function (data) {
          var s = data.stats;
          console.log(data);
          this.title = s.title;
          this.pid = s.pid;
          this.uptime = s.uptime.toFixed(3);
          this.heapTotal = s.heapTotal;
          this.heapUsed = s.heapUsed;
          this.totalmem = s.totalmem;
          this.freemem = s.freemem;
        }.bind(this));
      }
    });
  </script>
</polymer-element>
